% set parameters for gammatone filterbank as used in IF controlled compression

bands = 30;

center_freqs_hz = [123.380196 163.471375 208.124634 257.8591 313.252991 374.950287 443.668335 520.205933 605.452942 700.400452 806.152283 923.937927 1055.12671 1201.24377 1363.98792 1545.25122 1747.14075 1972.00366 2222.45483 2501.40503 2812.0979 3158.14551 3543.57031 3972.85425 4450.9873 4983.52832 5576.66797 6237.30371 6973.11475 7792.65625];

band_widths_hz = [37.9880142 42.310791 47.1254272 52.4879608 58.4606934 65.1131287 72.522522 80.7749939 89.9666138 100.204163 111.606689 124.306641 138.451721 154.206787 171.754395 191.298584 213.066895 237.312378 264.31665 294.394043 327.894531 365.205566 406.76416 453.049805 504.604004 562.024414 625.979492 697.210449 776.547363 864.913086];

coeffs = [(0.988129318+0.0319285318i) (0.986451983+0.0422426872i) (0.984460294+0.0536933355i) (0.982087195+0.066399008i) (0.979264021+0.0804894194i) (0.975883007+0.0961032584i) (0.97182101+0.113389432i) (0.96694833+0.132508546i) (0.96109587+0.153629407i) (0.954035819+0.176923543i) (0.945525467+0.202569917i) (0.935248613+0.230741709i) (0.922841907+0.261605978i) (0.907832861+0.295299619i) (0.889728665+0.331944913i) (0.867856979+0.371583343i) (0.841486454+0.414192438i) (0.80973953+0.459623277i) (0.771594048+0.507552683i) (0.725912631+0.557436645i) (0.671428144+0.608418286i) (0.606787503+0.659233749i) (0.530628562+0.708108425i) (0.441687822+0.752622306i) (0.33898437+0.789570212i) (0.222114086+0.814868867i) (0.0916414261+0.82349062i) (-0.0503581539+0.809538305i) (-0.199621752+0.766539693i) (-0.348932654+0.688085914i)];

norms = [0.0135034267 0.0150363259 0.0167399812 0.0186357982 0.0207322836 0.0230662953 0.0256706513 0.0285582524 0.0317552574 0.0353168771 0.0392660126 0.0436532684 0.0485133119 0.0539269447 0.0598957278 0.0665238574 0.073850818 0.0819462836 0.0909004137 0.100783885 0.111685358 0.123701327 0.136920661 0.1514384 0.167366356 0.184805021 0.203860939 0.224637538 0.24722898 0.271730781];

phases = [3.08540009048 2.04631141166 0.888982261993 -0.400043122994 -1.83574924267 2.84835730931 1.06731282719 -0.916398303127 -3.12584342687 0.879843778424 0.488191093996 -0.0175816433182 -0.486651306717 -0.962991540257 -1.14755130998 -1.37773415335 -1.73346257743 -1.80121710567 -2.09658653377 -2.10616420448 -1.76419867352 -1.82045725693 -2.48764864481 -1.95225953256 -2.12522834221 -2.02539821699 -1.58999913234 -0.745511533533 -1.23157235314 -1.55157152817];

delays = [0 0 0 0 0 0 0 0 0 1 12 21 29 36 43 49 54 59 63 67 71 74 76 79 81 83 85 87 88 89];

resynthesis_gains = [0.937132239 1.05790365 0.982664049 0.88012892 0.793364346 0.725311995 0.674799383 0.63413161 0.602127373 0.593710601 0.592315674 0.600061774 0.595743895 0.597027838 0.596883535 0.598001897 0.598514497 0.595614493 0.595372379 0.597749293 0.600147545 0.597219467 0.598782539 0.595296919 0.596791804 0.595239103 0.600145757 0.592552304 0.612592936 0.770601034];

srate = 24000; order = 4; prefilter_order = 3;


% create filterbank, instantaneous frequency estimator, and test signal

filterbank = ...
 gtfb_simple_bridge_gamma_filter_new(coeffs, norms, srate, ...
                order, delays, phases, resynthesis_gains, prefilter_order);
ifest = gtfb_instantaneous_frequency_new(srate, center_freqs_hz, ...
                                         band_widths_hz, repmat(0.001,1,bands));
impulse = zeros(1,8192);
impulse(1) = 1;


% compute gammatone filterbank response
[gt_response, filterbank] = ...
    gtfb_simple_bridge_gamma_prefilter(filterbank, impulse);

% estimation of instantaneous frequency

[gt_if, ifest] = gtfb_instantaneous_frequency(ifest, gt_response);

% =================================================================
% gt_response will be modified at this stage by the
% instantaneous frequency controlled compressor. 
% =================================================================

% compute output signal
[output, filterbank] = ...
    gtfb_simple_bridge_gamma_postfilter(filterbank, gt_response);

%%-----------------------------------------------------------------------------
%%
%%   Copyright (C) 2010 HoerTech gGmbH
%%                        http://www.hoertech.de/
%%
%%   Permission to use, copy, and distribute this software/file and its
%%   documentation for any purpose without permission by HoerTech
%%   is not granted.
%%   
%%   This software is provided "as is" without expressed or implied warranty.
%%
%%   Author: Tobias Herzke
%%
%%-----------------------------------------------------------------------------
